/***
 * Photoswiper v3.0.4
 * Built for Node.js
 * Copyright 2016-2019 Evan Yamanishi
 * Licensed under MIT
 ***/
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var PhotoSwipe=_interopDefault(require("photoswipe")),tabtrap=_interopDefault(require("tabtrap")),PhotoSwipeUIDefault=_interopDefault(require("photoswipe/dist/photoswipe-ui-default")),merge=_interopDefault(require("lodash.merge"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,i,s={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||(s[r]=e[r]);return s}function _objectWithoutProperties(e,t){if(null==e)return{};var r,i,s=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}const isValidPswp=e=>Array.from(e.querySelectorAll("a")).some(e=>1===e.querySelectorAll("img").length),bemSelectors=e=>({GALLERY:".".concat(e),TITLE:".".concat(e,"__title"),FIGURE:".".concat(e,"__figure"),LINK:".".concat(e,"__link"),THUMB:".".concat(e,"__thumbnail"),CAPTION:".".concat(e,"__caption")}),getUrlParam=e=>{if(!window.location.hash)return;const t=window.location.hash.substr(1).split("&").map(e=>e.split("=")).find(t=>t[0]===e);return t?t[1]:t},Default={onInit:()=>{},onOpen:()=>{},photoswipeUI:PhotoSwipeUIDefault,selectors:{PSWP:".pswp",GALLERY:"figure",TITLE:"figcaption",FIGURE:"figure",LINK:"a",THUMB:"img",CAPTION:"figcaption"}};class Photoswiper{constructor(e,t){if(this.galleryElement=e,t.structure&&!t.selectors&&(process.emitWarning('The "structure" option has been renamed "selectors".\n"structure" will be removed in a future update.',"DeprecationWarning"),t.selectors=t.structure),this.config=merge({},Photoswiper.Default,t),!isValidPswp(this.galleryElement))throw new Error("Gallery elements must contain a linked image (a[href]>img[src]).\n",this.galleryElement);{this.onClick=this.clickHandler.bind(this);const e=this.config.bemRoot?bemSelectors(this.config.bemRoot):{};this.selectors=merge({},this.config.selectors,e);const t=this.galleryElement.querySelectorAll(this.selectors.FIGURE);this.figures=t.length?t:[this.galleryElement],this.items=Array.from(this.figures).map(e=>this.parseFigure(e)),this.figures.forEach(e=>{e.querySelector(this.selectors.LINK).addEventListener("click",this.onClick)}),this.enabled=!0,"function"==typeof this.config.onInit&&this.config.onInit.call(this,this.figures)}}static get Default(){return Default}static get pid(){const e=getUrlParam("pid");return e?parseInt(e,10):void 0}static get gid(){const e=getUrlParam("gid");return e?parseInt(e,10):void 0}get pswpEl(){return document.querySelector(this.selectors.PSWP)||new Error("Make sure to include the .pswp galleryElement on your page")}get pswpOptions(){const e=_objectWithoutProperties(this.config,["bemRoot","onInit","onOpen","photoswipeUI","selectors","structure"]);return merge({},e,{galleryUID:this.config.galleryUID||this.galleryElement.getAttribute("data-pswp-uid"),getThumbBoundsFn:e=>{const t=this.items[e].el.querySelector(this.selectors.THUMB),r=window.pageYOffset||document.documentElement.scrollTop,i=t.getBoundingClientRect();return{x:i.left,y:i.top+r,w:i.width}}})}enable(){this.enabled=!0}disable(){this.enabled=!1}toggle(){this.enabled=!this.enabled}open(e,t,r=!1){const i=_objectSpread({index:e},this.pswpOptions);if(r&&(this.opts.showAnimationDuration=0),this.pswp=new PhotoSwipe(this.pswpEl,this.config.photoswipeUI,this.items,i),this.enabled){this.pswp.init(),this.isOpen=!0,"function"==typeof this.config.onOpen&&this.config.onOpen.call(this,this.pswp),new tabtrap(this.pswpEl);let e=0;this.pswpEl.addEventListener("keydown",t=>{"Tab"===t.key&&(this.pswp.ui.setIdle(!1),clearTimeout(e),e=setTimeout(()=>{this.pswp.ui.setIdle(!0)},this.pswp.options.timeToIdle))}),this.pswp.listen("close",()=>{const e=this.pswp.getCurrentIndex();this.galleryElement.contains(t)||!t?this.figures[e].querySelector(this.selectors.LINK).focus():t.focus(),this.isOpen=!1})}return this.pswp}initListeners(){this.figures.forEach(e=>{e.querySelector(this.selectors.LINK).addEventListener("click",this.onClick)})}clickHandler(e=window.event){e.preventDefault();const t=e.target||e.srcElement,r=t.closest(this.selectors.FIGURE)||this.galleryElement,i=Array.from(this.figures).indexOf(r);this.open(i,t)}parseFigure(e){const t=e.querySelector(this.selectors.LINK),r=e.querySelector(this.selectors.THUMB),i=e.querySelector(this.selectors.CAPTION),s=t.getAttribute("data-size").split("x"),o={el:e,h:parseInt(s[1],10),w:parseInt(s[0],10),src:t.getAttribute("href")||t.getAttribute("data-href")};return r&&(o.alt=r.getAttribute("alt"),o.msrc=r.getAttribute("src")),i&&i.innerHTML.length>0&&(o.title=i.innerHTML),o}}module.exports=Photoswiper;
